{{ partial "head.html" . }}

<body>
    <div class="main animate__animated animate__fadeInDown">
        {{ partial "nav.html" . }}
        {{ partial "header.html" . }}
        <div class="content">
            <div class="list_with_title books-index-list">
                <style>
                /* Books Index Styles */
                .books-index-list .listing {
                    margin-bottom: 0px;
                }

                .books-index-list .listing_item {
                    margin-bottom: 10px;
                    border-bottom: 1px solid #eee;
                    padding-bottom: 10px;
                }

                .books-index-list .listing_item:last-child {
                    border-bottom: none;
                }

                /* PC端布局 */
                .books-index-list .book-info {
                    display: flex;
                    flex-direction: column;
                }

                .books-index-list .book-row {
                    display: flex;
                    justify-content: space-between;
                    align-items: baseline;
                    margin-bottom: 0px;
                }

                .books-index-list .book-title-cn {
                    font-size: 1.15rem;
                    font-weight: 500;
                    flex: 1;
                }

                .books-index-list .book-title-cn a {
                    color: #34495e;
                    text-decoration: none;
                    transition: color 0.3s ease;
                }

                .books-index-list .book-title-cn a:hover {
                    color: #3273dc;
                }

                .books-index-list .book-word-count {
                    color: #7f8c8d;
                    font-size: 0.9rem;
                    white-space: nowrap;
                    margin-left: 15px;
                }

                .books-index-list .book-title-en {
                    font-size: 0.9rem;
                    color: #95a5a6;
                    font-style: italic;
                    flex: 1;
                }

                .books-index-list .book-date {
                    color: #95a5a6;
                    font-size: 0.85rem;
                    white-space: nowrap;
                    margin-left: 15px;
                }

                /* 默认隐藏移动端元素 */
                .books-index-list .mobile-only {
                    display: none;
                }

                /* 移动端响应式布局 */
                @media screen and (max-width: 768px) {
                    /* 隐藏PC端元素 */
                    .books-index-list .pc-only {
                        display: none;
                    }

                    /* 显示移动端元素 */
                    .books-index-list .mobile-only {
                        display: flex;
                    }

                    .books-index-list .book-row {
                        flex-direction: column;
                        align-items: flex-start;
                    }

                    .books-index-list .book-title-cn,
                    .books-index-list .book-title-en {
                        width: 100%;
                        margin-bottom: 8px;
                    }

                    .books-index-list .book-word-count,
                    .books-index-list .book-date {
                        margin-left: 0;
                    }

                    .books-index-list .book-meta-row {
                        display: flex;
                        justify-content: space-between;
                        align-items: center;
                        width: 100%;
                        margin-top: 4px;
                    }

                    .books-index-list .book-meta-row .book-word-count {
                        text-align: left;
                    }

                    .books-index-list .book-meta-row .book-date {
                        text-align: right;
                    }
                }

                /* Disabled book styles */
                .books-index-list .book-title-cn.disabled {
                    color: #bdc3c7;
                    cursor: default;
                }

                .books-index-list .book-title-cn.disabled:hover {
                    color: #bdc3c7;
                }

                .books-index-list .book-title-en.disabled {
                    color: #d5d8da;
                }
                </style>

                {{ $allBooksBySlug := dict }}
                {{ range .Site.Pages }}
                    {{ if eq .Type "book" }}
                        {{ $bookSlug := path.Base .File.Dir }}
                        {{ $allBooksBySlug = merge $allBooksBySlug (dict $bookSlug .) }}
                    {{ end }}
                {{ end }}

                {{ $bookCollection := slice
                    (dict "volume" "第1卷" "books" (slice
                        (dict "slug" "reality-construction" "title" "实在建构：从无限可能到有限确定（草稿）" "subtitle" "Reality Construction: From Infinite Possibility to Finite Certainty")
                        (dict "slug" "" "title" "观察者们：共同创造的现实" "subtitle" "Observers: The Co-Created Reality")
                        (dict "slug" "" "title" "神在观察之外：一种不确定的神学" "subtitle" "God Beyond Observation: A Theology of Uncertainty")
                    ))
                    (dict "volume" "第2卷" "books" (slice
                        (dict "slug" "the-breath-of-words" "title" "词语的呼吸：语言如何塑造我们（草稿）" "subtitle" "The Breath of Words: How Language Shapes Us")
                        (dict "slug" "" "title" "沉默的建构：身体、空间与情感" "subtitle" "The Silent Construction: Body, Space, and Emotion")
                        (dict "slug" "" "title" "再叙历史：作为观念生态演化的文明" "subtitle" "Revisiting History: Civilization as the Evolution of Conceptual Ecology")
                    ))
                    (dict "volume" "第3卷" "books" (slice
                        (dict "slug" "the-fetters-of-evaluation" "title" "评估的枷锁：数字时代的权力与控制（草稿）" "subtitle" "The Fetters of Evaluation: Power and Control in the Digital Age")
                        (dict "slug" "" "title" "暴力的共识：国家、革命与秩序的边界" "subtitle" "The Violent Consensus: Boundaries of State, Revolution, and Order")
                        (dict "slug" "" "title" "世界的多重宇宙：主权国家作为实在建构者" "subtitle" "The Multiverse of Worlds: Sovereign States as Reality Constructors")
                        (dict "slug" "" "title" "信任的基底：从血缘到算法" "subtitle" "The Foundation of Trust: From Blood Ties to Algorithms")
                    ))
                    (dict "volume" "第4卷" "books" (slice
                        (dict "slug" "the-optionality-advantage" "title" "选择权优势：在不确定世界中的可持续决策（草稿）" "subtitle" "The Optionality Advantage: Sustainable Decision-Making in an Uncertain World")
                        (dict "slug" "" "title" "如何观察：为可塑的未来而教育" "subtitle" "How to Observe: Educating for a Malleable Future")
                        (dict "slug" "" "title" "心念视界：内在游戏" "subtitle" "The Mind's Horizon:  The Inner Game")
                    ))
                }}

                {{ range $volumeData := $bookCollection }}
                <div class="listing">
                    <div class="listing_title">{{ $volumeData.volume }}</div>

                    {{ range $book := $volumeData.books }}
                        {{ $bookPage := index $allBooksBySlug $book.slug }}
                        {{ $exists := ne $bookPage nil }}

                        {{ if $exists }}
                            {{ $totalWords := 0 }}
                            {{ $allPages := $bookPage.RegularPagesRecursive }}
                            {{ range $allPages }}
                                {{ $totalWords = add $totalWords .WordCount }}
                            {{ end }}

                            <div class="listing_item">
                                <div class="book-info">
                                    <!-- PC端：第一行显示中文名和字数 -->
                                    <div class="book-row">
                                        <div class="book-title-cn">
                                            <a href="{{ $bookPage.RelPermalink }}">{{ $book.title }}</a>
                                        </div>
                                        <div class="book-word-count pc-only">约 {{ lang.FormatNumber 0 $totalWords }} 字</div>
                                    </div>

                                    <!-- PC端：第二行显示英文名和日期 -->
                                    <div class="book-row">
                                        {{ if $book.subtitle }}
                                        <div class="book-title-en">{{ $book.subtitle }}</div>
                                        {{ end }}
                                        <div class="book-date pc-only">
                                            <span class="date">{{ $bookPage.Lastmod.Format "2006-01-02" }}</span>
                                        </div>
                                    </div>

                                    <!-- 移动端：第三行显示字数和日期 -->
                                    <div class="book-meta-row mobile-only">
                                        <div class="book-word-count">约 {{ lang.FormatNumber 0 $totalWords }} 字</div>
                                        <div class="book-date">
                                            <span class="date">{{ $bookPage.Lastmod.Format "2006-01-02" }}</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        {{ else }}
                            <div class="listing_item">
                                <div class="book-info">
                                    <!-- PC端：第一行显示中文名（无字数） -->
                                    <div class="book-row">
                                        <div class="book-title-cn disabled">{{ $book.title }}</div>
                                    </div>

                                    <!-- PC端：第二行显示英文名（如果有） -->
                                    {{ if $book.subtitle }}
                                    <div class="book-row">
                                        <div class="book-title-en disabled">{{ $book.subtitle }}</div>
                                    </div>
                                    {{ end }}
                                </div>
                            </div>
                        {{ end }}
                    {{ end }}
                </div>
                {{ end }}
            </div>
            <div class="pagination"></div>
        </div>
        <a id="back_to_top" href="#" class="back_to_top"><i class="ri-arrow-up-s-line"></i></a>
    </div>
    {{ partial "footer.html" . }}
    {{ partial "js.html" . }}
</body>

</html>
